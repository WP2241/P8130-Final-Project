---
title: "FinalProject"
author: "Hyewon Choi"
date: "12/8/2017"
output: html_document
---

```{r first}
library(readr)
library(readxl)
library(janitor)
library(tidyverse)
library(pander)
hos = read_excel("./data/GHProject_Dataset.xlsx") 

hos <- hos %>% 
  clean_names() %>% 
  select(patientid, visitid, admitdtm, losdays2, is30dayreadmit, mews, cindex, evisit, icu_flag, ageyear, gender, race, religion, maritalstatus, insurancetype, bmi:bpdiastolic)
  


 unique_visit <- hos %>% 
   group_by(patientid) %>% 
   filter(!duplicated(patientid))

hos_tidy <- unique_visit

summary_losdays2 = hos_tidy %>% 
  ungroup(patientid) %>% 
  dplyr::select(losdays2) %>%
  summarize( variable = names(.),
  n_observation = n(),
  mean = mean(losdays2),
  SD = sd(losdays2),
  minimum = min(losdays2),
  maximum = max(losdays2),
  median = median(losdays2))

summary_ageyear = hos_tidy %>% 
  ungroup(patientid) %>% 
  dplyr::select(ageyear) %>%
  summarize( variable = names(.),
  n_observation = n(),
  mean = mean(ageyear),
  SD = sd(ageyear),
  minimum = min(ageyear),
  maximum = max(ageyear),
  median = median(ageyear))

summary_evisit = hos_tidy %>% 
  ungroup(patientid) %>% 
  dplyr::select(evisit) %>%
  summarize( variable = names(.),
  n_observation = n(),
  mean = mean(evisit),
  SD = sd(evisit),
  minimum = min(evisit),
  maximum = max(evisit),
  median = median(evisit))


 summary = rbind(summary_losdays2, summary_ageyear, summary_evisit)
 pander(summary)
           
```

```{r Kathryn}
hos_tidy %>%
  ggplot(aes(x = losdays2)) + 
    geom_histogram()

y = log(hos_tidy$losdays2)

hos_tidy$gender = ifelse(hos_tidy$gender == "Male", 1, ifelse(hos_tidy$gender == "Female", 0, NA))

hos_tidy$race = ifelse(hos_tidy$race == "White", 0, ifelse(hos_tidy$race == "African Amer/Black", 1, ifelse(hos_tidy$race == "Asian", 2, ifelse(hos_tidy$race == "Native Amer/Alaskan", 3, ifelse(hos_tidy$race == "Natv Hawaii/Pacf Isl", 4, ifelse(hos_tidy$race == "Other/Multiracial", 5, NA))))))

hos_tidy$insurancetype = ifelse(hos_tidy$insurancetype == "Medicare", 0, ifelse(hos_tidy$insurancetype == "Medicaid", 1, ifelse(hos_tidy$insurancetype == "Private", 2, ifelse(hos_tidy$insurancetype == "NA", 3, NA))))
```

### Stepwise selection
```{r Ginny}
mult.fit <- lm(life_exp ~ log(population) + income + log(illiteracy) + murder + hs_grad + frost + log(area), data=state)
step(mult.fit, direction="both")
```

### Criterion-based procedures
```{r Ginny}
state = state %>%
  mutate(logpopulation = log(population),
         logilliteracy = log(illiteracy),
         logarea = log(area))
mult.fit2 <- lm(life_exp ~ logpopulation + income + logilliteracy + murder + hs_grad + frost + logarea, data=state)
best <- function(model, ...) 
{
  subsets <- regsubsets(formula(model), model.frame(model), ...)
  subsets <- with(summary(subsets),
                  cbind(p = as.numeric(rownames(which)), which, rss, rsq, adjr2, cp, bic))
  
  return(subsets)
}  

best(mult.fit2, nbest = 1)
```

